/*! For license information please see 0e49e2.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{233:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=s(0),n=s(4),a=s(6);const i=0,r=4;class d{constructor(){this._modalContainer=(0,o.querySelector)(".modal"),this._wrap=(0,o.querySelector)(".js-orphus"),this._form=(0,o.querySelector)(this._wrap,"form"),this._closeButton=(0,o.querySelector)(this._wrap,".modal__close"),this._framing=null,this._selection=null,this._text=null,this._modalClass="modal--orphus",this._modalSubmitBtn=(0,o.querySelector)(this._wrap,'button[type="submit"]'),this.init()}init(){this.getSelectedText(),(0,a.addEventListener)(this._form,"submit",this.onSubmit.bind(this)),this._wrap.addEventListener("closeModal",this.onClose.bind(this))}getSelectedText(){let t;document.addEventListener("keydown",e=>{if((0,n.hasClass)(this._modalContainer,this._modalClass))return;"Enter"===e.key&&(e.metaKey||e.ctrlKey)&&t&&"string"==typeof t&&(window.modal.open("orphus"),this.setTextToModal(t))}),document.addEventListener("selectionchange",()=>{if(t=document.getSelection(),"Range"===t.type){if(this._text=t.anchorNode.data,this._text){const e=t.anchorNode.compareDocumentPosition(t.focusNode),s=e===r,o=s?t.anchorNode:t.focusNode,n=s?t.focusNode:t.anchorNode;let a=s?t.anchorOffset:t.focusOffset,d=s?t.focusOffset:t.anchorOffset;e===i&&(a=t.anchorOffset<=t.focusOffset?t.anchorOffset:t.focusOffset,d=t.focusOffset<=t.anchorOffset?t.anchorOffset:t.focusOffset);const c=o.data?"<span>«...".concat(o.data.substr(0,a),"</span>"):"<span>«...</span>",l=n.data?"<span>".concat(n.data.substr(d,this._text.length-1),"...»</span>"):"<span>...»</span>";this._framing=c+l}t=t.toString()}})}setTextToModal(t){this._selection=t;const e=document.createElement("p"),s=document.createElement("mark");(0,n.addClass)(e,"modal__text"),e.innerHTML=this._framing,s.innerText=t;e.querySelector("span").after(s),this._form.prepend(e)}async onSubmit(t){t.preventDefault(),this._modalSubmitBtn.disabled=!0;const e=new FormData(this._form);e.append("selection",this._selection),e.append("text",this._text),e.append("url",window.location.href);const s=await fetch(this._form.action,{method:"POST",body:e,headers:{"X-Requested-With":"XMLHttpRequest"},credentials:"include"});this.onResponse(await s.json())}onResponse(t){const e=(0,o.querySelector)(this._wrap,".modal__notice");e&&this._wrap.removeChild(e);let s=document.createElement("div");s.innerHTML='<p class="modal__notice"></p>';const a=s.childNodes[0];a.innerHTML=t.msg,t.status?((0,n.addClass)(this._form,"hidden"),(0,n.addClass)(a,"modal__notice--green"),this._closeButton.focus()):(0,n.addClass)(a,"modal__notice--red"),this._wrap.insertBefore(a,this._form)}onClose(){(0,n.removeClass)(this._form,"hidden"),this._form.reset(),this._modalSubmitBtn.disabled="";const t=(0,o.querySelector)(this._wrap,".modal__notice");t&&this._wrap.removeChild(t);const e=(0,o.querySelector)(this._form,".modal__text");e&&this._form.removeChild(e)}}e.default=d,new d}}]);